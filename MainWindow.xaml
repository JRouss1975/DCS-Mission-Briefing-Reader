<Window
    x:Class="DCSMissionReader.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:gmap="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="DCS Mission Briefing Reader v1.1a"
    Width="1200" Height="800" mc:Ignorable="d" Background="Transparent">

    <Grid>
        <!-- Background Image -->
        <Grid.Background>
            <ImageBrush ImageSource="/Resources/Background/bg001.png" Stretch="UniformToFill" />
        </Grid.Background>

        <Grid Background="{StaticResource DCS_Background}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350" />
                <ColumnDefinition Width="2" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" /> <!-- Title Bar -->
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" /> <!-- Status Bar -->
            </Grid.RowDefinitions>

            <!-- DCS Style Top Bar (Simplified) -->
            <Border Grid.Row="0" Grid.ColumnSpan="3" Background="#EE0C121D" BorderBrush="{StaticResource DCS_Border}" BorderThickness="0,0,0,1" Padding="10,8">
                <Grid>
                    <TextBlock Text="DCS MISSION BRIEFING READER v1.1a" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold" VerticalAlignment="Center" FontSize="24" HorizontalAlignment="Left"/>
                    <Button x:Name="AboutButton" Content="ABOUT" HorizontalAlignment="Right" VerticalAlignment="Center" Style="{StaticResource DCSButtonStyle}" Click="AboutButton_Click" Width="80"/>
                </Grid>
            </Border>

            <!-- Main Application Content -->
            <Grid Grid.Row="1" Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Left List Header Controls -->
                <StackPanel Grid.Row="0" Margin="10,10,10,5" Orientation="Horizontal">
                    <CheckBox
                        x:Name="GroupByTheaterCheckBox" VerticalAlignment="Center" Checked="GroupByTheaterCheckBox_Changed" Content="GROUP THEATER"
                        Unchecked="GroupByTheaterCheckBox_Changed" />

                    <Button
                        x:Name="ExpandAllButton" Margin="15,0,5,0" Click="ExpandAllButton_Click"
                        IsEnabled="{Binding IsChecked, ElementName=GroupByTheaterCheckBox}"
                        ToolTip="Expand All" Padding="5,3">
                        <Path Width="12" Height="12" Data="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"
                              Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                    </Button>
                    <Button
                        x:Name="CollapseAllButton" Margin="0,0,0,0" Click="CollapseAllButton_Click"
                        IsEnabled="{Binding IsChecked, ElementName=GroupByTheaterCheckBox}"
                        ToolTip="Collapse All" Padding="5,3">
                        <Path Width="12" Height="12" Data="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"
                              Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                    </Button>

                    <!-- Separator -->
                    <Rectangle Width="1" Height="20" Fill="{StaticResource DCS_Border}" Margin="15,0,8,0" />

                    <!-- Sorting Buttons -->
                    <Button x:Name="SortAZButton" Margin="0,0,5,0" Click="SortAZButton_Click" ToolTip="Sort A-Z" Padding="5,3">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="A↓Z" FontSize="10" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="SortZAButton" Margin="0,0,5,0" Click="SortZAButton_Click" ToolTip="Sort Z-A" Padding="5,3">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Z↓A" FontSize="10" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="SortDateButton" Margin="0,0,5,0" Click="SortDateButton_Click" ToolTip="Sort by Date (Newest First)" Padding="5,3">
                        <StackPanel Orientation="Horizontal">
                            <Path Width="12" Height="12" Data="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1"
                                  Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                        </StackPanel>
                    </Button>
                    <Button x:Name="SortSizeButton" Margin="0,0,0,0" Click="SortSizeButton_Click" ToolTip="Sort by Size (Largest First)" Padding="5,3">
                        <StackPanel Orientation="Horizontal">
                            <Path Width="12" Height="12" Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M10,13H8V17H10V13M14,11H12V17H14V11M18,15H16V17H18V15Z"
                                  Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                        </StackPanel>
                    </Button>
                </StackPanel>

                <!-- Mission List -->
                <ListBox
                    x:Name="MissionFilesListBox" Grid.Row="1" Margin="10,0,5,10"
                    KeyDown="MissionFilesListBox_KeyDown" ScrollViewer.CanContentScroll="False" SelectionChanged="MissionFilesListBox_SelectionChanged" VirtualizingPanel.IsVirtualizing="False">
                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Click="MenuItemCopy_Click" Header="Copy">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Click="MenuItemPaste_Click" Header="Paste" IsEnabled="{Binding PlacementTarget.DataContext.IsMissionCopied, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M19,20H5V4H7V7H17V4H19V20M12,2A3,3 0 0,1 15,5V6H9V5A3,3 0 0,1 12,2M19,2A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V4A2,2 0 0,1 5,2H7.1C7.5,0.8 8.7,0 10,0H14C15.3,0 16.5,0.8 16.9,2H19Z" Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Click="MenuItemPasteToFolder_Click" Header="Paste to Folder..." IsEnabled="{Binding PlacementTarget.DataContext.IsMissionCopied, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13,9V3.5L18.5,9H13Z" Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Click="MenuItemOpenFolder_Click" Header="Open in File Explorer">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M20,18H4V8H20M20,6H12L10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6Z" Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <Separator />
                            <MenuItem Click="MenuItemRename_Click" Header="Rename">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                            <MenuItem Click="MenuItemDelete_Click" Header="Delete">
                                <MenuItem.Icon>
                                    <Path Width="14" Height="14" Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19V4M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" Fill="{StaticResource DCS_Red}" Stretch="Uniform" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </ContextMenu>
                    </ListBox.ContextMenu>
                    <ListBox.GroupStyle>
                        <GroupStyle>
                            <GroupStyle.ContainerStyle>
                                <Style TargetType="{x:Type GroupItem}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type GroupItem}">
                                                <Expander
                                                    Style="{StaticResource BriefingExpanderStyle}"
                                                    BorderThickness="0" Collapsed="Expander_Collapsed" Expanded="Expander_Expanded" IsExpanded="True"
                                                    Loaded="Expander_Loaded">
                                                    <Expander.Header>
                                                        <Border x:Name="headerBorder" Padding="10,5" Background="{StaticResource DCS_Header}" BorderBrush="{StaticResource DCS_Border}" BorderThickness="0,0,0,1">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock
                                                                    Margin="0" FontSize="13" FontWeight="Bold"
                                                                    Foreground="{StaticResource DCS_Highlight}"
                                                                    Text="{Binding Name, Converter={StaticResource StringToUppercaseConverter}}" />
                                                                <TextBlock
                                                                    Margin="10,0,0,0" VerticalAlignment="Center" FontSize="11"
                                                                    Foreground="{StaticResource DCS_TextMuted}"
                                                                    Text="{Binding ItemCount, StringFormat=' ({0})'}" />
                                                            </StackPanel>
                                                        </Border>
                                                    </Expander.Header>
                                                    <ItemsPresenter />
                                                </Expander>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </GroupStyle.ContainerStyle>
                        </GroupStyle>
                    </ListBox.GroupStyle>
                </ListBox>
            </Grid>

            <!-- Status Bar -->
            <Border Grid.Row="2" Grid.ColumnSpan="3" Background="#EE0C121D" BorderBrush="{StaticResource DCS_Border}" BorderThickness="0,1,0,0" Padding="10,8">
                <Grid>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                        <Button x:Name="OpenFolderButton" Click="OpenFolderButton_Click" Content="DCS MISSIONS FOLDER :" Style="{StaticResource DCSButtonStyle}" Foreground="{StaticResource DCS_TextMuted}" FontSize="12" ToolTip="Select Missions Folder"/>
                        <TextBlock Margin="10,0,0,0" VerticalAlignment="Center" Foreground="{StaticResource DCS_Text}" Text="{Binding CurrentFolderPath}" FontSize="11"/>
                        <TextBlock Margin="5,0,0,0" VerticalAlignment="Center" Foreground="{StaticResource DCS_Highlight}" Text="{Binding NumberOfMissions, StringFormat='({0} missions)'}" FontSize="11"/>
                    </StackPanel>
                    <!--<TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="NOT MADE OR SUPPORTED BY EAGLE DYNAMICS SA." Foreground="{StaticResource DCS_Red}" FontSize="8" FontWeight="Bold" Opacity="0.7"/>-->
                    <CheckBox x:Name="IncludeSubfoldersCheckBox" HorizontalAlignment="Right" VerticalAlignment="Center" Checked="IncludeSubfoldersCheckBox_Changed" Content="INCLUDE SUBFOLDERS" Foreground="{StaticResource DCS_TextMuted}" FontSize="11" Unchecked="IncludeSubfoldersCheckBox_Changed" />
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter
                Grid.Row="1" Grid.Column="1" Width="2" HorizontalAlignment="Stretch"
                Background="{StaticResource DCS_Border}" />

            <!-- Main Content Area -->
            <Grid Grid.Row="1" Grid.Column="2" Margin="5,10,10,10">
                <TabControl>
                    <TabItem Header="BRIEFING">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <!-- Basic Info -->
                            <Border Grid.Row="0" Margin="0,0,0,10" Padding="15" Background="{StaticResource DCS_Panel}" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                <Grid>
                                    <WrapPanel Orientation="Horizontal">
                                        <StackPanel Margin="0,0,30,5">
                                            <TextBlock Text="DATE" FontSize="10" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold"/>
                                            <TextBlock Foreground="{StaticResource DCS_Text}" Text="{Binding Date}" FontSize="14"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,30,5">
                                            <TextBlock Text="START TIME" FontSize="10" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold"/>
                                            <TextBlock Foreground="{StaticResource DCS_Text}" Text="{Binding StartTime}" FontSize="14"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,30,5">
                                            <TextBlock Text="THEATER" FontSize="10" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold"/>
                                            <TextBlock Foreground="{StaticResource DCS_Text}" Text="{Binding Theatre}" FontSize="14"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,30,5">
                                            <TextBlock Text="SORTIE" FontSize="10" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold"/>
                                            <TextBox x:Name="SortieTextBox" Foreground="{StaticResource DCS_Text}" FontSize="14"
                                                     Background="Transparent" BorderThickness="0,0,0,1" BorderBrush="{StaticResource DCS_Border}"
                                                     MinWidth="150" Padding="0,2"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,30,5">
                                            <TextBlock Text="MISSION FILE PATH" FontSize="10" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold"/>
                                            <TextBlock Foreground="{StaticResource DCS_Text}" Text="{Binding CurrentMissionPath}" FontSize="14"/>
                                        </StackPanel>
                                    </WrapPanel>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                        <Button x:Name="ExpandAllTasksButton" Margin="0,0,5,0" Click="ExpandAllTasksButton_Click"
                                                ToolTip="Expand All Tasks" Padding="5,3">
                                            <Path Width="12" Height="12" Data="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"
                                                  Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                        </Button>
                                        <Button x:Name="CollapseAllTasksButton" Margin="0,0,15,0" Click="CollapseAllTasksButton_Click"
                                                ToolTip="Collapse All Tasks" Padding="5,3">
                                            <Path Width="12" Height="12" Data="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z"
                                                  Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                        </Button>
                                        <Button x:Name="UpdateBriefingButton" Click="UpdateBriefingButton_Click" ToolTip="Save Briefing Changes to Mission File" Padding="8,6">
                                            <Path Width="16" Height="16" Data="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"
                                                  Fill="{StaticResource DCS_Highlight}" Stretch="Uniform" />
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Briefing Sections Container -->
                            <Grid x:Name="BriefingSectionsGrid" Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" MinHeight="30" />
                                    <RowDefinition Height="5" />
                                    <RowDefinition Height="Auto" MinHeight="30" />
                                    <RowDefinition Height="5" />
                                    <RowDefinition Height="Auto" MinHeight="30" />
                                    <RowDefinition Height="5" />
                                    <RowDefinition Height="Auto" MinHeight="30" />
                                </Grid.RowDefinitions>

                                <!-- Situation Section -->
                                <Expander Grid.Row="0" IsExpanded="True" Margin="0,0,0,0" BorderThickness="0"
                                          Style="{StaticResource BriefingExpanderStyle}"
                                          Expanded="BriefingExpander_Expanded" Collapsed="BriefingExpander_Collapsed" Tag="0">
                                    <Expander.Header>
                                        <Border Background="{StaticResource DCS_Header}" Padding="10,5" Margin="0">
                                            <TextBlock Text="SITUATION" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" FontSize="12"/>
                                        </Border>
                                    </Expander.Header>
                                    <Border Background="#440D1117" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1,0,1,1">
                                        <TextBox
                                            x:Name="BriefingTextBlock" Padding="15" AcceptsReturn="True"
                                            Background="Transparent" BorderThickness="0" FontFamily="Consolas" FontSize="13"
                                            Foreground="{StaticResource DCS_Text}" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                                    </Border>
                                </Expander>

                                <!-- Splitter 1 -->
                                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                              Background="{StaticResource DCS_Border}" Cursor="SizeNS" />

                                <!-- Blue Tasks Section -->
                                <Expander Grid.Row="2" IsExpanded="False" Margin="0,0,0,0" BorderThickness="0"
                                          Style="{StaticResource BriefingExpanderStyle}"
                                          Expanded="BriefingExpander_Expanded" Collapsed="BriefingExpander_Collapsed" Tag="2">
                                    <Expander.Header>
                                        <Border Background="#1E3A5F" Padding="10,5" Margin="0">
                                            <TextBlock Text="BLUE TASKS" FontWeight="Bold" Foreground="#4A90E2" FontSize="12"/>
                                        </Border>
                                    </Expander.Header>
                                    <Border Background="#440D1117" BorderBrush="#4A90E2" BorderThickness="1,0,1,1">
                                        <TextBox
                                            x:Name="BlueTaskTextBlock" Padding="15" AcceptsReturn="True"
                                            Background="Transparent" BorderThickness="0" FontFamily="Consolas" FontSize="13"
                                            Foreground="{StaticResource DCS_Text}" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                                    </Border>
                                </Expander>

                                <!-- Splitter 2 -->
                                <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                              Background="{StaticResource DCS_Border}" Cursor="SizeNS" />

                                <!-- Red Tasks Section -->
                                <Expander Grid.Row="4" IsExpanded="False" Margin="0,0,0,0" BorderThickness="0"
                                          Style="{StaticResource BriefingExpanderStyle}"
                                          Expanded="BriefingExpander_Expanded" Collapsed="BriefingExpander_Collapsed" Tag="4">
                                    <Expander.Header>
                                        <Border Background="#5A1F1A" Padding="10,5" Margin="0">
                                            <TextBlock Text="RED TASKS" FontWeight="Bold" Foreground="#C0392B" FontSize="12"/>
                                        </Border>
                                    </Expander.Header>
                                    <Border Background="#440D1117" BorderBrush="#C0392B" BorderThickness="1,0,1,1">
                                        <TextBox
                                            x:Name="RedTaskTextBlock" Padding="15" AcceptsReturn="True"
                                            Background="Transparent" BorderThickness="0" FontFamily="Consolas" FontSize="13"
                                            Foreground="{StaticResource DCS_Text}" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                                    </Border>
                                </Expander>

                                <!-- Splitter 3 -->
                                <GridSplitter Grid.Row="5" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                              Background="{StaticResource DCS_Border}" Cursor="SizeNS" />

                                <!-- Neutrals Section -->
                                <Expander Grid.Row="6" IsExpanded="False" Margin="0,0,0,0" BorderThickness="0"
                                          Style="{StaticResource BriefingExpanderStyle}"
                                          Expanded="BriefingExpander_Expanded" Collapsed="BriefingExpander_Collapsed" Tag="6">
                                    <Expander.Header>
                                        <Border Background="#3A3A3A" Padding="10,5" Margin="0">
                                            <TextBlock Text="NEUTRALS" FontWeight="Bold" Foreground="#AAAAAA" FontSize="12"/>
                                        </Border>
                                    </Expander.Header>
                                    <Border Background="#440D1117" BorderBrush="#888888" BorderThickness="1,0,1,1">
                                        <TextBox
                                            x:Name="NeutralsTaskTextBlock" Padding="15" AcceptsReturn="True"
                                            Background="Transparent" BorderThickness="0" FontFamily="Consolas" FontSize="13"
                                            Foreground="{StaticResource DCS_Text}" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
                                    </Border>
                                </Expander>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <TabItem Header="IMAGES">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="ImagesItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="10" Padding="5" Background="{StaticResource DCS_Panel}" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                            <Image MaxWidth="800" Source="{Binding}" Stretch="Uniform" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                    </TabItem>

                    <TabItem Header="KNEEBOARD">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="KneeboardItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="10" Padding="5" Background="{StaticResource DCS_Panel}" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                            <Image MaxWidth="800" Source="{Binding}" Stretch="Uniform" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                    </TabItem>

                    <TabItem Header="UNITS DATA">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Units in Mission Section -->
                            <Border Grid.Row="0" Margin="0,0,0,10" Background="#440D1117" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Border Grid.Row="0" Background="{StaticResource DCS_Header}" Padding="10,5">
                                        <TextBlock Text="UNITS IN MISSION" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" FontSize="12"/>
                                    </Border>
                                    <DataGrid Grid.Row="1" x:Name="FlightsDataGrid" AutoGenerateColumns="False" HeadersVisibility="Column" IsReadOnly="True" BorderThickness="0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Coalition}" Header="COALITION" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Country}" Header="COUNTRY" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding GroupType}" Header="GROUP TYPE" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Task}" Header="TASK" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding GroupName}" Header="GROUP NAME" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding UnitName}" Header="UNIT NAME" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Type}" Header="TYPE" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding UnitId}" Header="UNIT ID" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Skill}" Header="SKILL" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding CallSign}" Header="CALLSIGN" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding X, StringFormat=\{0:F0\}}" Header="X" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Y, StringFormat=\{0:F0\}}" Header="Y" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Alt, StringFormat=\{0:F0\}}" Header="ALT" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Speed, StringFormat=\{0:F0\}}" Header="SPD" />
                                            <DataGridTextColumn Width="Auto" Binding="{Binding Heading, StringFormat=\{0:F1\}}" Header="HDG" />
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </Border>

                            <!-- Weather and Required Mods Section -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="10" />
                                    <ColumnDefinition Width="250" />
                                </Grid.ColumnDefinitions>

                                <!-- Weather Section -->
                                <Border Grid.Column="0" MinHeight="180" Background="#440D1117" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <Border Grid.Row="0" Background="{StaticResource DCS_Header}" Padding="10,5">
                                            <TextBlock Text="WEATHER" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" FontSize="12"/>
                                        </Border>
                                        <Grid Grid.Row="1" Margin="15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="TEMP" Foreground="{StaticResource DCS_Highlight}" FontSize="10" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Weather.Temperature, StringFormat={}{0:F1}°C}" Foreground="{StaticResource DCS_Text}" FontSize="24" Margin="0,0,0,10"/>
                                                <TextBlock Text="QNH" Foreground="{StaticResource DCS_Highlight}" FontSize="10" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding Weather.QNH, StringFormat={}{0} mmHg}" Foreground="{StaticResource DCS_Text}" FontSize="16"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="WINDS" Foreground="{StaticResource DCS_Highlight}" FontSize="10" FontWeight="Bold" Margin="0,0,0,10"/>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Ground:" Foreground="{StaticResource DCS_TextMuted}" FontSize="13"/>
                                                    <TextBlock Grid.Row="0" Grid.Column="1" Margin="25,0,0,0" Text="{Binding WeatherStringGround}" Foreground="{StaticResource DCS_Text}" FontSize="13" FontWeight="SemiBold"/>

                                                    <TextBlock Grid.Row="1" Grid.Column="0" Margin="0,5,0,0" Text="2000m:" Foreground="{StaticResource DCS_TextMuted}" FontSize="13"/>
                                                    <TextBlock Grid.Row="1" Grid.Column="1" Margin="25,5,0,0" Text="{Binding WeatherString2000}" Foreground="{StaticResource DCS_Text}" FontSize="13" FontWeight="SemiBold"/>

                                                    <TextBlock Grid.Row="2" Grid.Column="0" Margin="0,5,0,0" Text="8000m:" Foreground="{StaticResource DCS_TextMuted}" FontSize="13"/>
                                                    <TextBlock Grid.Row="2" Grid.Column="1" Margin="25,5,0,0" Text="{Binding WeatherString8000}" Foreground="{StaticResource DCS_Text}" FontSize="13" FontWeight="SemiBold"/>
                                                </Grid>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Border>

                                <!-- Required Mods Section -->
                                <Border Grid.Column="2" MinHeight="180" Background="#440D1117" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>
                                        <Border Grid.Row="0" Background="{StaticResource DCS_Header}" Padding="10,5">
                                            <TextBlock Text="REQUIRED MODS" FontWeight="Bold" Foreground="{StaticResource DCS_Highlight}" FontSize="12"/>
                                        </Border>
                                        <ListBox x:Name="RequiredModsListBox" Grid.Row="1" Background="Transparent" BorderThickness="0" Padding="10,5"
                                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" Foreground="{StaticResource DCS_Text}" FontSize="12" Margin="0,2"/>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                        <TextBlock x:Name="NoModsText" Grid.Row="1" Text="No mods required"
                                                   Foreground="{StaticResource DCS_TextMuted}" FontSize="12" FontStyle="Italic"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <TabItem Header="MAP OVERVIEW">
                        <Grid Background="#FF1B263B">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Margin="0,0,0,10" Padding="8" Background="{StaticResource DCS_Panel}" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button x:Name="ResetViewButton" Margin="0,0,15,0" Click="ResetViewButton_Click" Content="RESET VIEW" />
                                    <ToggleButton x:Name="ShowLegendButton" Content="LEGEND" IsChecked="True" Margin="0,0,25,0"/>

                                    <CheckBox x:Name="ShowRoutesCheckBox" Margin="0,0,20,0" Checked="MapOptionsChanged" Content="ROUTES" IsChecked="True" Unchecked="MapOptionsChanged" />
                                    <CheckBox x:Name="ShowLabelsCheckBox" Margin="0,0,20,0" Checked="MapOptionsChanged" Content="LABELS" IsChecked="True" Unchecked="MapOptionsChanged" />
                                    <CheckBox x:Name="ShowBlueCheckBox" Margin="0,0,20,0" Checked="MapOptionsChanged" Content="BLUE" Foreground="#4A90E2" IsChecked="True" Unchecked="MapOptionsChanged" />
                                    <CheckBox x:Name="ShowRedCheckBox" Checked="MapOptionsChanged" Content="RED" Foreground="#C0392B" IsChecked="True" Unchecked="MapOptionsChanged" />
                                </StackPanel>
                            </Border>

                            <Border Grid.Row="1" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1">
                                <Grid>
                                    <gmap:GMapControl x:Name="MainMap" MouseWheelZoomType="MousePositionWithoutCenter" />
                                    <!-- Map Legend -->
                                    <Border x:Name="LegendPanel" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="15" Padding="20" Background="#EE121826" BorderBrush="{StaticResource DCS_Border}" BorderThickness="1" Visibility="{Binding IsChecked, ElementName=ShowLegendButton, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Width="160">
                                            <TextBlock Text="MAP LEGEND" Foreground="{StaticResource DCS_Highlight}" FontWeight="Bold" FontSize="13" Margin="0,0,0,20" HorizontalAlignment="Center"/>

                                            <TextBlock Text="COALITIONS" Foreground="{StaticResource DCS_TextMuted}" FontSize="9" FontWeight="Bold" Margin="0,5,0,8"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Rectangle Width="14" Height="14" Fill="#4A90E2" />
                                                <TextBlock Text="Blue Coalition" Foreground="White" Margin="12,0,0,0" FontSize="12"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Rectangle Width="14" Height="14" Fill="#C0392B" />
                                                <TextBlock Text="Red Coalition" Foreground="White" Margin="12,0,0,0" FontSize="12"/>
                                            </StackPanel>

                                            <TextBlock Text="UNIT TYPES" Foreground="{StaticResource DCS_TextMuted}" FontSize="9" FontWeight="Bold" Margin="0,20,0,8"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Polygon Points="7,2 2,14 12,14" Fill="White" Stroke="Black" />
                                                <TextBlock Text="Air Unit" Foreground="White" Margin="12,0,0,0" FontSize="12"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Rectangle Width="12" Height="12" Fill="White" Stroke="Black" />
                                                <TextBlock Text="Ground Unit" Foreground="White" Margin="14,0,0,0" FontSize="12"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Polygon Points="7,1 13,7 7,13 1,7" Fill="White" Stroke="Black" />
                                                <TextBlock Text="Ship Unit" Foreground="White" Margin="12,0,0,0" FontSize="12"/>
                                            </StackPanel>

                                            <TextBlock Text="NAVIGATION" Foreground="{StaticResource DCS_TextMuted}" FontSize="9" FontWeight="Bold" Margin="0,20,0,8"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Line X1="0" Y1="7" X2="14" Y2="7" Stroke="White" StrokeThickness="1" StrokeDashArray="5,3" />
                                                <TextBlock Text="Route" Foreground="White" Margin="12,0,0,0" FontSize="12"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                                <Ellipse Width="10" Height="10" Fill="White" Stroke="Black" Margin="2,0,0,0"/>
                                                <TextBlock Text="Waypoint" Foreground="White" Margin="14,0,0,0" FontSize="12"/>
                                            </StackPanel>

                                            <Separator Margin="0,15,0,10" Background="{StaticResource DCS_Border}"/>

                                            <TextBlock Text="OSM Attribution" Foreground="{StaticResource DCS_TextMuted}" FontSize="9" FontWeight="Bold" Margin="0,0,0,5"/>
                                            <TextBlock Foreground="{StaticResource DCS_TextMuted}" FontSize="9" TextWrapping="Wrap">
                                                Map data © <Hyperlink NavigateUri="https://www.openstreetmap.org/copyright" RequestNavigate="Hyperlink_RequestNavigate" Foreground="{StaticResource DCS_Highlight}">OpenStreetMap</Hyperlink>
                                            </TextBlock>

                                            <!--<TextBlock Text="Disclaimer" Foreground="{StaticResource DCS_TextMuted}" FontSize="9" FontWeight="Bold" Margin="0,10,0,5"/>
                                            <TextBlock Text="THIS MATERIAL IS NOT MADE OR SUPPORTED BY EAGLE DYNAMICS SA." Foreground="{StaticResource DCS_Red}" FontSize="8" FontWeight="Bold" TextWrapping="Wrap"/>-->
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Grid>
</Window>
